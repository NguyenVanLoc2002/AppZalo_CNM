{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport axios from \"axios\";\nimport config from \"./config\";\nimport toast from \"react-hot-toast\";\nimport { AsyncStorage } from \"react-native-web/dist/index\";\nvar axiosInstance = axios.create({\n  baseURL: config.baseURL\n});\nvar isWeb = Platform.OS === \"web\";\naxiosInstance.interceptors.request.use(function () {\n  var _ref = _asyncToGenerator(function* (config) {\n    try {\n      var token = isWeb ? localStorage.getItem(\"accessToken\") : yield AsyncStorage.getItem(\"accessToken\");\n      if (token) {\n        config.headers.Authorization = `Bearer ${token}`;\n      }\n      return config;\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  });\n  return function (_x) {\n    return _ref.apply(this, arguments);\n  };\n}(), function (error) {\n  return Promise.reject(error);\n});\naxiosInstance.interceptors.response.use(function (response) {\n  return response;\n}, function () {\n  var _ref2 = _asyncToGenerator(function* (error) {\n    var originalRequest = error.config;\n    var reqURL = originalRequest.url;\n    if (error.response.status === 401 && !reqURL.includes(\"/auth/login\")) {\n      try {\n        var refreshToken = isWeb ? localStorage.getItem(\"refreshToken\") : yield AsyncStorage.getItem(\"refreshToken\");\n        if (!refreshToken) {\n          toast.error(\"Your session has expired. Please login again.\");\n          throw new Error(\"No refresh token available.\");\n        }\n        var refreshedTokenResponse = yield axiosInstance.post(\"/auth/refreshToken\", {\n          refreshToken: refreshToken\n        });\n        var newAccessToken = refreshedTokenResponse.data.newAccessToken;\n        if (isWeb) {\n          localStorage.setItem(\"accessToken\", newAccessToken);\n        } else {\n          yield AsyncStorage.setItem(\"accessToken\", newAccessToken);\n        }\n        originalRequest.headers.Authorization = `Bearer ${newAccessToken}`;\n        return axiosInstance(originalRequest);\n      } catch (refreshError) {\n        console.error(\"Refresh token failed:\", refreshError);\n        toast.error(\"Your session has expired. Please login again.\");\n        if (isWeb) {\n          localStorage.clear();\n        } else {\n          yield AsyncStorage.clear();\n        }\n        return Promise.reject(refreshError);\n      }\n    }\n    return Promise.reject(error);\n  });\n  return function (_x2) {\n    return _ref2.apply(this, arguments);\n  };\n}());\nexport default axiosInstance;","map":{"version":3,"names":["axios","config","toast","AsyncStorage","axiosInstance","create","baseURL","isWeb","Platform","OS","interceptors","request","use","_ref","_asyncToGenerator","token","localStorage","getItem","headers","Authorization","error","Promise","reject","_x","apply","arguments","response","_ref2","originalRequest","reqURL","url","status","includes","refreshToken","Error","refreshedTokenResponse","post","newAccessToken","data","setItem","refreshError","console","clear","_x2"],"sources":["C:/Users/huynh/OneDrive/Desktop/ZaloFake/AppZalo_CNM/Frontend/Mobile/zalofake/src/api/axiosInstance.js"],"sourcesContent":["import axios from \"axios\";\r\nimport config from \"./config\";\r\nimport toast from \"react-hot-toast\";\r\nimport { AsyncStorage } from \"react-native\";\r\n\r\nconst axiosInstance = axios.create({\r\n  baseURL: config.baseURL,\r\n});\r\n\r\nconst isWeb = Platform.OS === \"web\"; // Kiểm tra nếu môi trường là web\r\n\r\naxiosInstance.interceptors.request.use(\r\n  async (config) => {\r\n    try {\r\n      const token = isWeb\r\n        ? localStorage.getItem(\"accessToken\")\r\n        : await AsyncStorage.getItem(\"accessToken\");\r\n      if (token) {\r\n        config.headers.Authorization = `Bearer ${token}`;\r\n      }\r\n      return config;\r\n    } catch (error) {\r\n      return Promise.reject(error);\r\n    }\r\n  },\r\n  (error) => {\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\naxiosInstance.interceptors.response.use(\r\n  (response) => {\r\n    return response;\r\n  },\r\n  async (error) => {\r\n    const originalRequest = error.config;\r\n    const reqURL = originalRequest.url;\r\n\r\n    if (error.response.status === 401 && !reqURL.includes(\"/auth/login\")) {\r\n      try {\r\n        const refreshToken = isWeb\r\n          ? localStorage.getItem(\"refreshToken\")\r\n          : await AsyncStorage.getItem(\"refreshToken\");\r\n        if (!refreshToken) {\r\n          toast.error(\"Your session has expired. Please login again.\");\r\n          throw new Error(\"No refresh token available.\");\r\n        }\r\n\r\n        const refreshedTokenResponse = await axiosInstance.post(\r\n          \"/auth/refreshToken\",\r\n          {\r\n            refreshToken: refreshToken,\r\n          }\r\n        );\r\n        const newAccessToken = refreshedTokenResponse.data.newAccessToken;\r\n\r\n        if (isWeb) {\r\n          localStorage.setItem(\"accessToken\", newAccessToken);\r\n        } else {\r\n          await AsyncStorage.setItem(\"accessToken\", newAccessToken);\r\n        }\r\n\r\n        originalRequest.headers.Authorization = `Bearer ${newAccessToken}`;\r\n        return axiosInstance(originalRequest);\r\n      } catch (refreshError) {\r\n        console.error(\"Refresh token failed:\", refreshError);\r\n        toast.error(\"Your session has expired. Please login again.\");\r\n        if (isWeb) {\r\n          localStorage.clear();\r\n        } else {\r\n          await AsyncStorage.clear();\r\n        }\r\n        return Promise.reject(refreshError);\r\n      }\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport default axiosInstance;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}