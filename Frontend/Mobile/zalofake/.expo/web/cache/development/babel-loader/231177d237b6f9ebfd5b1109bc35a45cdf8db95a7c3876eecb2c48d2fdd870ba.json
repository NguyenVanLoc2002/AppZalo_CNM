{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport axios from \"axios\";\nimport config from \"./config\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport toast from \"react-hot-toast\";\nvar axiosInstance = axios.create({\n  baseURL: config.baseURL\n});\naxiosInstance.interceptors.request.use(function () {\n  var _ref = _asyncToGenerator(function* (config) {\n    if (Platform.OS === \"web\") {} else if (Platform.OS === \"android\" || Platform.OS === \"ios\") {\n      try {\n        var token = yield AsyncStorage.getItem(\"accessToken\");\n        if (token) {\n          config.headers.Authorization = `Bearer ${token}`;\n        }\n      } catch (error) {\n        return Promise.reject(error);\n      }\n    }\n    return config;\n  });\n  return function (_x) {\n    return _ref.apply(this, arguments);\n  };\n}(), function (error) {\n  return Promise.reject(error);\n});\naxiosInstance.interceptors.response.use(function (response) {\n  return response;\n}, function () {\n  var _ref2 = _asyncToGenerator(function* (error) {\n    if (Platform.OS === \"web\") {} else if (Platform.OS === \"android\" || Platform.OS === \"ios\") {\n      var originalRequest = error.config;\n      if (error.response.status === 401) {\n        try {\n          var refreshToken = yield AsyncStorage.getItem(\"refreshToken\");\n          if (!refreshToken) {\n            if (toast) {\n              toast.error(\"Your session has expired. Please login again.\");\n            } else {\n              console.error(\"Toast is not defined. Unable to display error message.\");\n            }\n            throw new Error(\"No refresh token available.\");\n          }\n          var refreshedTokenResponse = yield axiosInstance.post(\"/auth/refreshToken\", {\n            refreshToken: refreshToken\n          });\n          var newAccessToken = refreshedTokenResponse.data.newAccessToken;\n          yield AsyncStorage.setItem(\"accessToken\", newAccessToken);\n          originalRequest.headers.Authorization = `Bearer ${newAccessToken}`;\n          return axiosInstance(originalRequest);\n        } catch (refreshError) {\n          console.error(\"Refresh token failed:\", refreshError);\n          if (toast) {\n            toast.error(\"Your session has expired. Please login again.\");\n          } else {\n            console.error(\"Toast is not defined. Unable to display error message.\");\n          }\n          yield AsyncStorage.clear();\n          return Promise.reject(refreshError);\n        }\n      } else if (error.response.status === 403) {\n        console.error(\"Request failed with status code 403:\", error);\n        if (toast) {\n          toast.error(\"Access forbidden. Please try again later.\");\n        } else {\n          console.error(\"Toast is not defined. Unable to display error message.\");\n        }\n      }\n    }\n    return Promise.reject(error);\n  });\n  return function (_x2) {\n    return _ref2.apply(this, arguments);\n  };\n}());\nexport default axiosInstance;","map":{"version":3,"names":["axios","config","Platform","AsyncStorage","toast","axiosInstance","create","baseURL","interceptors","request","use","_ref","_asyncToGenerator","OS","token","getItem","headers","Authorization","error","Promise","reject","_x","apply","arguments","response","_ref2","originalRequest","status","refreshToken","console","Error","refreshedTokenResponse","post","newAccessToken","data","setItem","refreshError","clear","_x2"],"sources":["C:/Users/huynh/OneDrive/Desktop/ZaloFake/AppZalo_CNM/Frontend/Mobile/zalofake/src/api/axiosInstance.js"],"sourcesContent":["import axios from \"axios\";\r\nimport config from \"./config\";\r\nimport { Platform } from \"react-native\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport toast from \"react-hot-toast\"; // Đảm bảo cài đặt và import toast từ thư viện react-hot-toast\r\n\r\nconst axiosInstance = axios.create({\r\n  baseURL: config.baseURL,\r\n});\r\n\r\naxiosInstance.interceptors.request.use(\r\n  async (config) => {\r\n    if (Platform.OS === \"web\") {\r\n      // Thực hiện các xử lý cho môi trường Web\r\n    } else if (Platform.OS === \"android\" || Platform.OS === \"ios\") {\r\n      // Thực hiện các xử lý cho React Native\r\n      try {\r\n        const token = await AsyncStorage.getItem(\"accessToken\");\r\n        if (token) {\r\n          config.headers.Authorization = `Bearer ${token}`;\r\n        }\r\n      } catch (error) {\r\n        return Promise.reject(error);\r\n      }\r\n    }\r\n    return config;\r\n  },\r\n  (error) => {\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\naxiosInstance.interceptors.response.use(\r\n  (response) => {\r\n    return response;\r\n  },\r\n  async (error) => {\r\n    if (Platform.OS === \"web\") {\r\n      // Thực hiện các xử lý cho môi trường Web\r\n    } else if (Platform.OS === \"android\" || Platform.OS === \"ios\") {\r\n      // Thực hiện các xử lý cho React Native\r\n      const originalRequest = error.config;\r\n\r\n      if (error.response.status === 401) {\r\n        try {\r\n          const refreshToken = await AsyncStorage.getItem(\"refreshToken\");\r\n          if (!refreshToken) {\r\n            if (toast) {\r\n              toast.error(\"Your session has expired. Please login again.\");\r\n            } else {\r\n              console.error(\r\n                \"Toast is not defined. Unable to display error message.\"\r\n              );\r\n            }\r\n            throw new Error(\"No refresh token available.\");\r\n          }\r\n\r\n          const refreshedTokenResponse = await axiosInstance.post(\r\n            \"/auth/refreshToken\",\r\n            {\r\n              refreshToken: refreshToken,\r\n            }\r\n          );\r\n          const newAccessToken = refreshedTokenResponse.data.newAccessToken;\r\n          await AsyncStorage.setItem(\"accessToken\", newAccessToken);\r\n\r\n          originalRequest.headers.Authorization = `Bearer ${newAccessToken}`;\r\n          return axiosInstance(originalRequest);\r\n        } catch (refreshError) {\r\n          console.error(\"Refresh token failed:\", refreshError);\r\n          if (toast) {\r\n            toast.error(\"Your session has expired. Please login again.\");\r\n          } else {\r\n            console.error(\r\n              \"Toast is not defined. Unable to display error message.\"\r\n            );\r\n          }\r\n          await AsyncStorage.clear();\r\n          // Sử dụng React Navigation để chuyển hướng người dùng\r\n          // const navigation = useNavigation();\r\n          // navigation.navigate('LoginScreen');\r\n          return Promise.reject(refreshError);\r\n        }\r\n      } else if (error.response.status === 403) {\r\n        // Xử lý khi yêu cầu bị từ chối (Forbidden)\r\n        console.error(\"Request failed with status code 403:\", error);\r\n        if (toast) {\r\n          toast.error(\"Access forbidden. Please try again later.\");\r\n        } else {\r\n          console.error(\r\n            \"Toast is not defined. Unable to display error message.\"\r\n          );\r\n        }\r\n        // Thực hiện các hành động khác nếu cần thiết\r\n      }\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport default axiosInstance;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}