{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport { useState } from \"react\";\nimport Toast from \"react-native-toast-message\";\nimport OTPTextView from 'react-native-otp-textinput';\nimport axiosInstance from \"../api/axiosInstance\";\nvar useRegister = function useRegister() {\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    isLoading = _useState2[0],\n    setIsLoading = _useState2[1];\n  var _useState3 = useState(null),\n    _useState4 = _slicedToArray(_useState3, 2),\n    systemOTP = _useState4[0],\n    setSystemOTP = _useState4[1];\n  var _useState5 = useState(false),\n    _useState6 = _slicedToArray(_useState5, 2),\n    isOTPVerified = _useState6[0],\n    setIsOTPVerified = _useState6[1];\n  var showToastSuccess = function showToastSuccess(notice) {\n    Toast.show({\n      text1: notice,\n      type: \"success\",\n      topOffset: 0,\n      position: \"top\"\n    });\n  };\n  var showToastError = function showToastError(notice) {\n    Toast.show({\n      text1: notice,\n      type: \"error\",\n      topOffset: 0,\n      position: \"top\"\n    });\n  };\n  var verifyOTP = function () {\n    var _ref = _asyncToGenerator(function* (userOTP, systemOTP) {\n      if (userOTP === systemOTP.otp && systemOTP.expires >= Date.now()) {\n        return true;\n      } else {\n        return false;\n      }\n    });\n    return function verifyOTP(_x, _x2) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  var sendOTP = function () {\n    var _ref2 = _asyncToGenerator(function* (email) {\n      var response = yield axiosInstance.post(\"/auth/send-otp\", {\n        email: email\n      });\n      var data = response.data;\n      return data.totp;\n    });\n    return function sendOTP(_x3) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var getOTP = function () {\n    var _ref3 = _asyncToGenerator(function* (email) {\n      if (check_mail(email)) {\n        console.log(check_mail(email));\n        setIsLoading(false);\n        return false;\n      } else {\n        try {\n          setIsLoading(true);\n          setIsOTPVerified(false);\n          var otp = yield sendOTP(email);\n          if (otp) {\n            showToastSuccess(\"OTP sent to your email\");\n            setIsLoading(false);\n            setSystemOTP(otp);\n            return true;\n          } else {\n            showToastError(\"Failed to send OTP\");\n            setIsLoading(false);\n            return false;\n          }\n        } catch (error) {\n          console.log(error);\n          showToastError(\"Failed to send OTP\");\n          setIsLoading(false);\n          return false;\n        }\n      }\n    });\n    return function getOTP(_x4) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var verifyEmailAndRegister = function () {\n    var _ref4 = _asyncToGenerator(function* (textEmail, otp, textPhone, name, dob, selectedGender, textPW) {\n      var verified = yield verifyOTP(otp, systemOTP);\n      setIsOTPVerified(verified);\n      try {\n        setIsLoading(true);\n        if (verified) {\n          var response = yield axiosInstance.post(\"/auth/register\", {\n            phone: textPhone,\n            email: textEmail,\n            password: textPW,\n            name: name,\n            dob: dob,\n            gender: selectedGender.toString(),\n            userOTP: otp\n          });\n          setIsOTPVerified(true);\n          var data = response.data;\n          console.log(data);\n          if (response.status === 201) {\n            setIsLoading(false);\n            showToastSuccess(\"Account created successfully\");\n            return true;\n          } else {\n            setIsLoading(false);\n            showToastError(data.response.message);\n            return false;\n          }\n        } else {\n          showToastError(\"Invalid OTP\");\n          setIsLoading(false);\n          return false;\n        }\n      } catch (error) {\n        console.log(error);\n        setIsOTPVerified(true);\n        setIsLoading(false);\n        showToastError(error.response.data.message);\n        return false;\n      }\n    });\n    return function verifyEmailAndRegister(_x5, _x6, _x7, _x8, _x9, _x10, _x11) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  var check_mail = function () {\n    var _ref5 = _asyncToGenerator(function* (email) {\n      try {\n        var response = yield axiosInstance.post(\"/users/check-email\", {\n          email: email\n        });\n        if (response.status === 404) {\n          console.log(response.status);\n          return false;\n        } else if (response.status === 200) {\n          console.log(response.status);\n          return true;\n        } else {\n          return false;\n        }\n      } catch (error) {\n        console.log(error.response.status);\n        return false;\n      }\n    });\n    return function check_mail(_x12) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n  return {\n    isLoading: isLoading,\n    setIsLoading: setIsLoading,\n    isOTPVerified: isOTPVerified,\n    getOTP: getOTP,\n    verifyEmailAndRegister: verifyEmailAndRegister,\n    showToastError: showToastError,\n    showToastSuccess: showToastSuccess\n  };\n};\nexport default useRegister;","map":{"version":3,"names":["useState","Toast","OTPTextView","axiosInstance","useRegister","_useState","_useState2","_slicedToArray","isLoading","setIsLoading","_useState3","_useState4","systemOTP","setSystemOTP","_useState5","_useState6","isOTPVerified","setIsOTPVerified","showToastSuccess","notice","show","text1","type","topOffset","position","showToastError","verifyOTP","_ref","_asyncToGenerator","userOTP","otp","expires","Date","now","_x","_x2","apply","arguments","sendOTP","_ref2","email","response","post","data","totp","_x3","getOTP","_ref3","check_mail","console","log","error","_x4","verifyEmailAndRegister","_ref4","textEmail","textPhone","name","dob","selectedGender","textPW","verified","phone","password","gender","toString","status","message","_x5","_x6","_x7","_x8","_x9","_x10","_x11","_ref5","_x12"],"sources":["C:/BaoTruc/iuh/ky2nam4/CNM/DeTai/AppZalo_CNM/Frontend/Mobile/zalofake/src/hooks/useRegister.js"],"sourcesContent":["\r\nimport { useState } from \"react\";\r\nimport Toast from \"react-native-toast-message\";\r\nimport OTPTextView from 'react-native-otp-textinput';\r\nimport axiosInstance from \"../api/axiosInstance\";\r\n\r\n\r\n\r\nconst useRegister = () => {\r\n\r\n\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [systemOTP, setSystemOTP] = useState(null);\r\n    const [isOTPVerified, setIsOTPVerified] = useState(false);\r\n\r\n    const showToastSuccess = (notice) => {\r\n        Toast.show({\r\n            text1: notice,\r\n            type: \"success\",\r\n            topOffset: 0,\r\n            position: \"top\",\r\n        });\r\n    };\r\n    const showToastError = (notice) => {\r\n        Toast.show({\r\n            text1: notice,\r\n            type: \"error\",\r\n            topOffset: 0,\r\n            position: \"top\",\r\n        });\r\n    };\r\n\r\n\r\n    const verifyOTP = async (userOTP, systemOTP) => {\r\n        if (userOTP === systemOTP.otp && systemOTP.expires >= Date.now()) {\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    };\r\n\r\n    const sendOTP = async (email) => {\r\n        const response = await axiosInstance.post(\"/auth/send-otp\", {\r\n            email,\r\n        });\r\n        const data = response.data;\r\n        return data.totp;\r\n    };\r\n\r\n    const getOTP = async (email) => {\r\n        if (check_mail(email)) {\r\n             // showToastError(\"Email already exists\");\r\n             console.log(check_mail(email))\r\n             setIsLoading(false);\r\n             return false;\r\n            \r\n        }\r\n        else {\r\n            try {\r\n                setIsLoading(true);\r\n                setIsOTPVerified(false);\r\n                const otp = await sendOTP(email);\r\n\r\n                if (otp) {\r\n                    showToastSuccess(\"OTP sent to your email\");\r\n                    setIsLoading(false);\r\n                    setSystemOTP(otp);\r\n                    return true;\r\n                } else {\r\n                    showToastError(\"Failed to send OTP\");\r\n                    setIsLoading(false);\r\n                    return false;\r\n                }\r\n            } catch (error) {\r\n                console.log(error);\r\n                showToastError(\"Failed to send OTP\");\r\n                setIsLoading(false);\r\n                return false;\r\n            }\r\n           \r\n        }\r\n    };\r\n\r\n    const verifyEmailAndRegister = async (\r\n        textEmail,\r\n        otp,\r\n        textPhone,\r\n        name,\r\n        dob,\r\n        selectedGender,\r\n        textPW\r\n    ) => {\r\n        const verified = await verifyOTP(otp, systemOTP);\r\n        setIsOTPVerified(verified);\r\n        try {\r\n            setIsLoading(true);\r\n            if (verified) {\r\n                const response = await axiosInstance.post(\"/auth/register\", {\r\n                    phone: textPhone,\r\n                    email: textEmail,\r\n                    password: textPW,\r\n                    name: name,\r\n                    dob: dob,\r\n                    gender: selectedGender.toString(),\r\n                    userOTP: otp\r\n                });\r\n                setIsOTPVerified(true);\r\n                const data = response.data;\r\n                console.log(data);\r\n\r\n                if (response.status === 201) {\r\n                    setIsLoading(false);\r\n                    showToastSuccess(\"Account created successfully\");\r\n                    return true;\r\n                } else {\r\n                    setIsLoading(false);\r\n                    showToastError(data.response.message);\r\n                    return false;\r\n                }\r\n            } else {\r\n                showToastError(\"Invalid OTP\");\r\n                setIsLoading(false);\r\n                return false;\r\n            }\r\n        } catch (error) {\r\n            console.log(error);\r\n            setIsOTPVerified(true);\r\n            setIsLoading(false);\r\n            showToastError(error.response.data.message);\r\n            return false;\r\n        }\r\n    };\r\n\r\n    const check_mail = async (email) => {\r\n        try {\r\n            const response = await axiosInstance.post(\"/users/check-email\", {\r\n                email,\r\n            });\r\n            if (response.status === 404) {\r\n                console.log(response.status)\r\n                return false;\r\n            }\r\n            else if (response.status === 200) {\r\n                console.log(response.status)\r\n                return true;\r\n            }\r\n            else {\r\n               \r\n                return false;\r\n            }\r\n        } catch (error) {\r\n            console.log(error.response.status)\r\n            return false;\r\n        }\r\n    }\r\n\r\n\r\n    return { isLoading,setIsLoading, isOTPVerified, getOTP, verifyEmailAndRegister, showToastError, showToastSuccess };\r\n};\r\n\r\n\r\nexport default useRegister;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}